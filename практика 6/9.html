<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Демонстрация Амплитудной Модуляции (AM)</title>
<style>
  body {
    background: #222;
    color: #eee;
    font-family: Arial, sans-serif;
    padding: 20px;
    text-align: center;
  }
  canvas {
    background: #000;
    border: 1px solid #555;
    margin-top: 20px;
  }
  .controls {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
  }
  label {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 16px;
  }
  input[type="range"] {
    width: 200px;
    margin-top: 5px;
  }
  .value {
    margin-top: 4px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Амплитудная Модуляция (AM)</h1>

<div class="controls">
  <label>
    Частота несущей (Hz)
    <input type="range" id="carrierFreq" min="50" max="500" step="1" value="200" />
    <div class="value" id="carrierFreqVal">200</div>
  </label>

  <label>
    Амплитуда несущей
    <input type="range" id="carrierAmp" min="0.1" max="2" step="0.01" value="1" />
    <div class="value" id="carrierAmpVal">1.00</div>
  </label>

  <label>
    Частота модуляции (Hz)
    <input type="range" id="modFreq" min="1" max="50" step="1" value="5" />
    <div class="value" id="modFreqVal">5</div>
  </label>

  <label>
    Глубина модуляции (0–1)
    <input type="range" id="modDepth" min="0" max="1" step="0.01" value="0.7" />
    <div class="value" id="modDepthVal">0.70</div>
  </label>
</div>

<canvas id="graph" width="900" height="400"></canvas>

<script>
  const canvas = document.getElementById('graph');
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  const margin = 50;

  const carrierFreqInput = document.getElementById('carrierFreq');
  const carrierAmpInput = document.getElementById('carrierAmp');
  const modFreqInput = document.getElementById('modFreq');
  const modDepthInput = document.getElementById('modDepth');

  const carrierFreqVal = document.getElementById('carrierFreqVal');
  const carrierAmpVal = document.getElementById('carrierAmpVal');
  const modFreqVal = document.getElementById('modFreqVal');
  const modDepthVal = document.getElementById('modDepthVal');

  // Диапазон времени для отображения (в секундах)
  const tStart = 0;
  const tEnd = 0.04; // 40 ms для видимости нескольких периодов

  function xToCanvas(t) {
    return margin + ((t - tStart) / (tEnd - tStart)) * (width - 2 * margin);
  }

  function yToCanvas(y) {
    // y в диапазоне [-2,2] (для визуализации)
    const yMin = -2.5;
    const yMax = 2.5;
    return height - margin - ((y - yMin) / (yMax - yMin)) * (height - 2 * margin);
  }

  function drawAxes() {
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 1;

    // Ось X
    ctx.beginPath();
    ctx.moveTo(margin, yToCanvas(0));
    ctx.lineTo(width - margin, yToCanvas(0));
    ctx.stroke();

    // Ось Y
    ctx.beginPath();
    ctx.moveTo(margin, margin);
    ctx.lineTo(margin, height - margin);
    ctx.stroke();

    // Метки по X (в миллисекундах)
    ctx.fillStyle = '#888';
    ctx.font = '12px monospace';
    const steps = 8;
    for(let i=0; i<=steps; i++){
      let t = tStart + i * (tEnd - tStart) / steps;
      let xPos = xToCanvas(t);
      ctx.fillText((t*1000).toFixed(1) + " ms", xPos - 20, yToCanvas(0) + 20);
    }

    // Метки по Y
    ctx.fillText('2', margin - 30, yToCanvas(2) + 4);
    ctx.fillText('0', margin - 20, yToCanvas(0) + 4);
    ctx.fillText('-2', margin - 30, yToCanvas(-2) + 4);
  }

  function drawSignal(signalFunc, color, lineWidth=2) {
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth;
    ctx.beginPath();

    for(let px = margin; px <= width - margin; px++) {
      let t = tStart + ((px - margin) / (width - 2 * margin)) * (tEnd - tStart);
      let y = signalFunc(t);
      let py = yToCanvas(y);
      if(px === margin) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
    ctx.stroke();
  }

  function modulatedSignal(t, carrierFreq, carrierAmp, modFreq, modDepth) {
    let modulating = Math.sin(2 * Math.PI * modFreq * t); // Модулирующий сигнал (от -1 до 1)
    // Формула АМ: A_c * [1 + m * sin(2π f_m t)] * sin(2π f_c t)
    return carrierAmp * (1 + modDepth * modulating) * Math.sin(2 * Math.PI * carrierFreq * t);
  }

  function draw() {
    const carrierFreq = parseFloat(carrierFreqInput.value);
    const carrierAmp = parseFloat(carrierAmpInput.value);
    const modFreq = parseFloat(modFreqInput.value);
    const modDepth = parseFloat(modDepthInput.value);

    carrierFreqVal.textContent = carrierFreq.toFixed(0);
    carrierAmpVal.textContent = carrierAmp.toFixed(2);
    modFreqVal.textContent = modFreq.toFixed(0);
    modDepthVal.textContent = modDepth.toFixed(2);

    ctx.clearRect(0, 0, width, height);
    drawAxes();

    // Несущая (carrier)
    drawSignal(t => carrierAmp * Math.sin(2 * Math.PI * carrierFreq * t), 'cyan', 1);

    // Модулирующий сигнал (modulating)
    drawSignal(t => modDepth * carrierAmp * Math.sin(2 * Math.PI * modFreq * t), 'yellow', 1);

    // AM сигнал (modulated)
    drawSignal(t => modulatedSignal(t, carrierFreq, carrierAmp, modFreq, modDepth), 'lime', 2);

    // Легенда
    ctx.fillStyle = 'cyan';
    ctx.fillRect(width - 150, margin, 15, 15);
    ctx.fillStyle = '#eee';
    ctx.fillText('Несущая', width - 130, margin + 12);

    ctx.fillStyle = 'yellow';
    ctx.fillRect(width - 150, margin + 25, 15, 15);
    ctx.fillStyle = '#eee';
    ctx.fillText('Модулирующий', width - 130, margin + 37);

    ctx.fillStyle = 'lime';
    ctx.fillRect(width - 150, margin + 50, 15, 15);
    ctx.fillStyle = '#eee';
    ctx.fillText('АМ сигнал', width - 130, margin + 62);
  }

  carrierFreqInput.addEventListener('input', draw);
  carrierAmpInput.addEventListener('input', draw);
  modFreqInput.addEventListener('input', draw);
  modDepthInput.addEventListener('input', draw);

  draw();
</script>

</body>
</html>
