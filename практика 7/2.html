<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - PSNR –∏ SSIM</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .visualization {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .image-box {
            flex: 1;
            min-width: 250px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        canvas {
            max-width: 100%;
            border-radius: 5px;
            background-color: #000;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .value-display {
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
        }
        
        button {
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .comparison-view {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .difference-map {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .histogram-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .histogram {
            flex: 1;
            min-width: 250px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .image-container {
                flex-direction: column;
            }
            
            .histogram-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ê–Ω–∞–ª–∏–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h1>
            <p class="subtitle">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ –∏—Å–∫–∞–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ PSNR (Peak Signal-to-Noise Ratio) –∏ SSIM (Structural Similarity Index)</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" id="analysisTab">–ê–Ω–∞–ª–∏–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π</div>
            <div class="tab" id="metricsTab">–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞</div>
            <div class="tab" id="comparisonTab">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
        </div>
        
        <div class="content">
            <div class="controls">
                <div class="control-group">
                    <label for="errorRate">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –±–∏—Ç–æ–≤: <span id="errorRateValue">5%</span></label>
                    <input type="range" id="errorRate" min="0" max="20" value="5" step="0.1">
                </div>
                
                <div class="control-group">
                    <label for="noiseType">–¢–∏–ø —à—É–º–∞:</label>
                    <select id="noiseType" style="width: 100%; padding: 10px; border-radius: 5px; background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.3);">
                        <option value="random">–°–ª—É—á–∞–π–Ω—ã–π —à—É–º</option>
                        <option value="gaussian">–ì–∞—É—Å—Å–æ–≤ —à—É–º</option>
                        <option value="saltpepper">–°–æ–ª—å-–ø–µ—Ä–µ—Ü</option>
                        <option value="packetLoss">–ü–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–æ–≤</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="compression">–°–∂–∞—Ç–∏–µ: <span id="compressionValue">0%</span></label>
                    <input type="range" id="compression" min="0" max="90" value="0" step="1">
                </div>
                
                <button id="applyDistortionBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–∫–∞–∂–µ–Ω–∏—è</button>
                <button id="analyzeBtn">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <div class="visualization">
                <div class="image-container">
                    <div class="image-box">
                        <h3>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                        <canvas id="originalCanvas" width="300" height="200"></canvas>
                    </div>
                    <div class="image-box">
                        <h3>–ò—Å–∫–∞–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                        <canvas id="distortedCanvas" width="300" height="200"></canvas>
                    </div>
                </div>
                
                <div class="metrics">
                    <div class="metric-card">
                        <div>PSNR</div>
                        <div class="metric-value" id="psnrValue">--</div>
                        <div class="metric-description">Peak Signal-to-Noise Ratio (dB)</div>
                    </div>
                    <div class="metric-card">
                        <div>SSIM</div>
                        <div class="metric-value" id="ssimValue">--</div>
                        <div class="metric-description">Structural Similarity Index</div>
                    </div>
                    <div class="metric-card">
                        <div>MSE</div>
                        <div class="metric-value" id="mseValue">--</div>
                        <div class="metric-description">Mean Squared Error</div>
                    </div>
                    <div class="metric-card">
                        <div>–ò—Å–∫–∞–∂–µ–Ω–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏</div>
                        <div class="metric-value" id="corruptedPixels">--</div>
                        <div class="metric-description">–ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π</div>
                    </div>
                </div>
                
                <div class="comparison-view" id="comparisonView" style="display: none;">
                    <div class="difference-map">
                        <h3>–ö–∞—Ä—Ç–∞ —Ä–∞–∑–ª–∏—á–∏–π</h3>
                        <canvas id="differenceCanvas" width="300" height="200"></canvas>
                        <p>–ë–µ–ª—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏</p>
                    </div>
                    
                    <div class="histogram-container">
                        <div class="histogram">
                            <h3>–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                            <canvas id="originalHistogram" width="250" height="150"></canvas>
                        </div>
                        <div class="histogram">
                            <h3>–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∏—Å–∫–∞–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                            <canvas id="distortedHistogram" width="250" height="150"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const errorRateSlider = document.getElementById('errorRate');
            const errorRateValue = document.getElementById('errorRateValue');
            const noiseTypeSelect = document.getElementById('noiseType');
            const compressionSlider = document.getElementById('compression');
            const compressionValue = document.getElementById('compressionValue');
            const applyDistortionBtn = document.getElementById('applyDistortionBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            const originalCanvas = document.getElementById('originalCanvas');
            const distortedCanvas = document.getElementById('distortedCanvas');
            const differenceCanvas = document.getElementById('differenceCanvas');
            const originalHistogram = document.getElementById('originalHistogram');
            const distortedHistogram = document.getElementById('distortedHistogram');
            
            // –ú–µ—Ç—Ä–∏–∫–∏
            const psnrValue = document.getElementById('psnrValue');
            const ssimValue = document.getElementById('ssimValue');
            const mseValue = document.getElementById('mseValue');
            const corruptedPixels = document.getElementById('corruptedPixels');
            
            // –í–∫–ª–∞–¥–∫–∏
            const analysisTab = document.getElementById('analysisTab');
            const metricsTab = document.getElementById('metricsTab');
            const comparisonTab = document.getElementById('comparisonTab');
            const comparisonView = document.getElementById('comparisonView');
            
            // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let originalImageData = null;
            let distortedImageData = null;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–æ–≤
            errorRateSlider.addEventListener('input', function() {
                errorRateValue.textContent = this.value + '%';
            });
            
            compressionSlider.addEventListener('input', function() {
                compressionValue.textContent = this.value + '%';
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        const img = new Image();
                        img.onload = function() {
                            const width = 300;
                            const height = 200;
                            
                            originalCanvas.width = width;
                            originalCanvas.height = height;
                            distortedCanvas.width = width;
                            distortedCanvas.height = height;
                            differenceCanvas.width = width;
                            differenceCanvas.height = height;
                            
                            const originalCtx = originalCanvas.getContext('2d');
                            originalCtx.drawImage(img, 0, 0, width, height);
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            originalImageData = originalCtx.getImageData(0, 0, width, height);
                            
                            // –û—á–∏—â–∞–µ–º –∏—Å–∫–∞–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            const distortedCtx = distortedCanvas.getContext('2d');
                            distortedCtx.clearRect(0, 0, width, height);
                            
                            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
                            resetMetrics();
                        };
                        img.src = event.target.result;
                    };
                    
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            function loadDefaultImage() {
                const img = new Image();
                img.onload = function() {
                    const width = 300;
                    const height = 200;
                    
                    originalCanvas.width = width;
                    originalCanvas.height = height;
                    distortedCanvas.width = width;
                    distortedCanvas.height = height;
                    differenceCanvas.width = width;
                    differenceCanvas.height = height;
                    
                    const originalCtx = originalCanvas.getContext('2d');
                    originalCtx.drawImage(img, 0, 0, width, height);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    originalImageData = originalCtx.getImageData(0, 0, width, height);
                };
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
                img.src = createDefaultImage();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            function createDefaultImage() {
                const canvas = document.createElement('canvas');
                canvas.width = 300;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                
                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                const gradient = ctx.createLinearGradient(0, 0, 300, 200);
                gradient.addColorStop(0, '#3498db');
                gradient.addColorStop(0.5, '#2ecc71');
                gradient.addColorStop(1, '#e74c3c');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 300, 200);
                
                // –¢–µ–∫—Å—Ç
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–¢–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 150, 100);
                
                // –ü—Ä–æ—Å—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.arc(80, 150, 30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.rect(200, 130, 80, 40);
                ctx.fill();
                
                return canvas.toDataURL();
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–∫–∞–∂–µ–Ω–∏–π
            applyDistortionBtn.addEventListener('click', function() {
                if (!originalImageData) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                    return;
                }
                
                const errorRate = parseFloat(errorRateSlider.value) / 100;
                const noiseType = noiseTypeSelect.value;
                const compression = parseInt(compressionSlider.value);
                
                applyDistortions(originalImageData, errorRate, noiseType, compression);
            });
            
            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–∫–∞–∂–µ–Ω–∏–π
            function applyDistortions(imageData, errorRate, noiseType, compression) {
                const width = imageData.width;
                const height = imageData.height;
                const distortedCtx = distortedCanvas.getContext('2d');
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                distortedImageData = new ImageData(
                    new Uint8ClampedArray(imageData.data),
                    width,
                    height
                );
                
                const totalPixels = width * height;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–∫–∞–∂–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —à—É–º–∞
                switch(noiseType) {
                    case 'random':
                        applyRandomNoise(distortedImageData, errorRate);
                        break;
                    case 'gaussian':
                        applyGaussianNoise(distortedImageData, errorRate);
                        break;
                    case 'saltpepper':
                        applySaltPepperNoise(distortedImageData, errorRate);
                        break;
                    case 'packetLoss':
                        applyPacketLoss(distortedImageData, errorRate);
                        break;
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∂–∞—Ç–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è)
                if (compression > 0) {
                    applyCompression(distortedImageData, compression);
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å–∫–∞–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                distortedCtx.putImageData(distortedImageData, 0, 0);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
                resetMetrics();
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —à—É–º–∞
            function applyRandomNoise(imageData, errorRate) {
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    if (Math.random() < errorRate) {
                        // –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
                        data[i] = Math.floor(Math.random() * 256);     // R
                        data[i+1] = Math.floor(Math.random() * 256);   // G
                        data[i+2] = Math.floor(Math.random() * 256);   // B
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≥–∞—É—Å—Å–æ–≤–∞ —à—É–º–∞
            function applyGaussianNoise(imageData, errorRate) {
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    if (Math.random() < errorRate) {
                        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∞—É—Å—Å–æ–≤–∞ —à—É–º–∞ —Å –ø–æ–º–æ—â—å—é Box-Muller –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
                        const u1 = Math.random();
                        const u2 = Math.random();
                        const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                        
                        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à—É–º–∞ –∫ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É
                        const noise = z0 * 50; // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —à—É–º–∞
                        data[i] = clamp(data[i] + noise, 0, 255);     // R
                        data[i+1] = clamp(data[i+1] + noise, 0, 255); // G
                        data[i+2] = clamp(data[i+2] + noise, 0, 255); // B
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à—É–º–∞ "—Å–æ–ª—å-–ø–µ—Ä–µ—Ü"
            function applySaltPepperNoise(imageData, errorRate) {
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    if (Math.random() < errorRate) {
                        // –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É "—Å–æ–ª—å—é" (–±–µ–ª—ã–π) –∏ "–ø–µ—Ä—Ü–µ–º" (—á–µ—Ä–Ω—ã–π)
                        const value = Math.random() < 0.5 ? 255 : 0;
                        data[i] = value;     // R
                        data[i+1] = value;   // G
                        data[i+2] = value;   // B
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤
            function applyPacketLoss(imageData, errorRate) {
                const data = imageData.data;
                const blockSize = 10; // –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –¥–ª—è –ø–æ—Ç–µ—Ä–∏
                
                for (let y = 0; y < imageData.height; y += blockSize) {
                    for (let x = 0; x < imageData.width; x += blockSize) {
                        if (Math.random() < errorRate) {
                            // –ü–æ—Ç–µ—Ä—è –±–ª–æ–∫–∞ - –∑–∞–∫—Ä–∞—à–∏–≤–∞–µ–º —á–µ—Ä–Ω—ã–º
                            for (let blockY = y; blockY < y + blockSize && blockY < imageData.height; blockY++) {
                                for (let blockX = x; blockX < x + blockSize && blockX < imageData.width; blockX++) {
                                    const idx = (blockY * imageData.width + blockX) * 4;
                                    data[idx] = 0;     // R
                                    data[idx+1] = 0;   // G
                                    data[idx+2] = 0;   // B
                                }
                            }
                        }
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∂–∞—Ç–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è)
            function applyCompression(imageData, compression) {
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å–∂–∞—Ç–∏—è JPEG
                const data = imageData.data;
                const blockSize = 8;
                const quality = 1 - (compression / 100);
                
                for (let y = 0; y < imageData.height; y += blockSize) {
                    for (let x = 0; x < imageData.width; x += blockSize) {
                        // –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –≤ –±–ª–æ–∫–µ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–∂–∞—Ç–∏—è
                        let rSum = 0, gSum = 0, bSum = 0;
                        let count = 0;
                        
                        for (let blockY = y; blockY < y + blockSize && blockY < imageData.height; blockY++) {
                            for (let blockX = x; blockX < x + blockSize && blockX < imageData.width; blockX++) {
                                const idx = (blockY * imageData.width + blockX) * 4;
                                rSum += data[idx];
                                gSum += data[idx+1];
                                bSum += data[idx+2];
                                count++;
                            }
                        }
                        
                        const rAvg = Math.floor(rSum / count);
                        const gAvg = Math.floor(gSum / count);
                        const bAvg = Math.floor(bSum / count);
                        
                        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –∫–∞—á–µ—Å—Ç–≤–∞
                        for (let blockY = y; blockY < y + blockSize && blockY < imageData.height; blockY++) {
                            for (let blockX = x; blockX < x + blockSize && blockX < imageData.width; blockX++) {
                                const idx = (blockY * imageData.width + blockX) * 4;
                                
                                // –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É –∏—Å—Ö–æ–¥–Ω—ã–º –∏ —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
                                data[idx] = Math.floor(data[idx] * quality + rAvg * (1 - quality));
                                data[idx+1] = Math.floor(data[idx+1] * quality + gAvg * (1 - quality));
                                data[idx+2] = Math.floor(data[idx+2] * quality + bAvg * (1 - quality));
                            }
                        }
                    }
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
            function clamp(value, min, max) {
                return Math.min(Math.max(value, min), max);
            }
            
            // –°–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫
            function resetMetrics() {
                psnrValue.textContent = '--';
                ssimValue.textContent = '--';
                mseValue.textContent = '--';
                corruptedPixels.textContent = '--';
            }
            
            // –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            analyzeBtn.addEventListener('click', function() {
                if (!originalImageData || !distortedImageData) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é');
                    return;
                }
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
                const mse = calculateMSE(originalImageData, distortedImageData);
                const psnr = calculatePSNR(mse);
                const ssim = calculateSSIM(originalImageData, distortedImageData);
                const corrupted = calculateCorruptedPixels(originalImageData, distortedImageData);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                mseValue.textContent = mse.toFixed(2);
                psnrValue.textContent = psnr.toFixed(2);
                ssimValue.textContent = ssim.toFixed(4);
                corruptedPixels.textContent = (corrupted * 100).toFixed(2) + '%';
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã —Ä–∞–∑–ª–∏—á–∏–π
                createDifferenceMap(originalImageData, distortedImageData);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
                createHistograms(originalImageData, distortedImageData);
            });
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ MSE (Mean Squared Error)
            function calculateMSE(original, distorted) {
                let sum = 0;
                const data1 = original.data;
                const data2 = distorted.data;
                const length = data1.length;
                
                for (let i = 0; i < length; i += 4) {
                    const rDiff = data1[i] - data2[i];
                    const gDiff = data1[i+1] - data2[i+1];
                    const bDiff = data1[i+2] - data2[i+2];
                    
                    sum += rDiff * rDiff + gDiff * gDiff + bDiff * bDiff;
                }
                
                return sum / (length / 4 * 3); // –£—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ RGB –∫–∞–Ω–∞–ª—ã
            }
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ PSNR (Peak Signal-to-Noise Ratio)
            function calculatePSNR(mse) {
                if (mse === 0) return Infinity;
                return 10 * Math.log10((255 * 255) / mse);
            }
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ SSIM (Structural Similarity Index)
            function calculateSSIM(original, distorted) {
                const data1 = original.data;
                const data2 = distorted.data;
                const length = data1.length;
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è
                const gray1 = new Float64Array(length / 4);
                const gray2 = new Float64Array(length / 4);
                
                for (let i = 0, j = 0; i < length; i += 4, j++) {
                    gray1[j] = 0.299 * data1[i] + 0.587 * data1[i+1] + 0.114 * data1[i+2];
                    gray2[j] = 0.299 * data2[i] + 0.587 * data2[i+1] + 0.114 * data2[i+2];
                }
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                let mean1 = 0, mean2 = 0;
                for (let i = 0; i < gray1.length; i++) {
                    mean1 += gray1[i];
                    mean2 += gray2[i];
                }
                mean1 /= gray1.length;
                mean2 /= gray1.length;
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∏—Å–ø–µ—Ä—Å–∏–π –∏ –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–∏
                let var1 = 0, var2 = 0, cov = 0;
                for (let i = 0; i < gray1.length; i++) {
                    var1 += (gray1[i] - mean1) * (gray1[i] - mean1);
                    var2 += (gray2[i] - mean2) * (gray2[i] - mean2);
                    cov += (gray1[i] - mean1) * (gray2[i] - mean2);
                }
                var1 /= gray1.length - 1;
                var2 /= gray1.length - 1;
                cov /= gray1.length - 1;
                
                // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                const C1 = (0.01 * 255) ** 2;
                const C2 = (0.03 * 255) ** 2;
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ SSIM
                const numerator = (2 * mean1 * mean2 + C1) * (2 * cov + C2);
                const denominator = (mean1 * mean1 + mean2 * mean2 + C1) * (var1 + var2 + C2);
                
                return numerator / denominator;
            }
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∏—Å–∫–∞–∂–µ–Ω–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
            function calculateCorruptedPixels(original, distorted) {
                let corrupted = 0;
                const data1 = original.data;
                const data2 = distorted.data;
                const length = data1.length;
                
                for (let i = 0; i < length; i += 4) {
                    if (data1[i] !== data2[i] || 
                        data1[i+1] !== data2[i+1] || 
                        data1[i+2] !== data2[i+2]) {
                        corrupted++;
                    }
                }
                
                return corrupted / (length / 4);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã —Ä–∞–∑–ª–∏—á–∏–π
            function createDifferenceMap(original, distorted) {
                const diffCtx = differenceCanvas.getContext('2d');
                const diffImageData = diffCtx.createImageData(original.width, original.height);
                const data1 = original.data;
                const data2 = distorted.data;
                const diffData = diffImageData.data;
                
                for (let i = 0; i < data1.length; i += 4) {
                    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
                    const rDiff = Math.abs(data1[i] - data2[i]);
                    const gDiff = Math.abs(data1[i+1] - data2[i+1]);
                    const bDiff = Math.abs(data1[i+2] - data2[i+2]);
                    
                    // –û–±—â–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
                    const avgDiff = (rDiff + gDiff + bDiff) / 3;
                    
                    // –£—Å–∏–ª–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –¥–ª—è –ª—É—á—à–µ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                    const enhancedDiff = Math.min(255, avgDiff * 5);
                    
                    // –ó–∞–ø–∏—Å—å –≤ –∫–∞—Ä—Ç—É —Ä–∞–∑–ª–∏—á–∏–π
                    diffData[i] = enhancedDiff;     // R
                    diffData[i+1] = enhancedDiff;   // G
                    diffData[i+2] = enhancedDiff;   // B
                    diffData[i+3] = 255;            // A
                }
                
                diffCtx.putImageData(diffImageData, 0, 0);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
            function createHistograms(original, distorted) {
                createHistogram(original, originalHistogram, '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                createHistogram(distorted, distortedHistogram, '–ò—Å–∫–∞–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            function createHistogram(imageData, canvas, title) {
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                // –û—á–∏—Å—Ç–∫–∞ canvas
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, width, height);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
                const histograms = {
                    r: new Array(256).fill(0),
                    g: new Array(256).fill(0),
                    b: new Array(256).fill(0)
                };
                
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    histograms.r[data[i]]++;
                    histograms.g[data[i+1]]++;
                    histograms.b[data[i+2]]++;
                }
                
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
                const maxCount = Math.max(
                    ...histograms.r, 
                    ...histograms.g, 
                    ...histograms.b
                );
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
                const barWidth = width / 256;
                
                // –ö—Ä–∞—Å–Ω—ã–π –∫–∞–Ω–∞–ª
                ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                for (let i = 0; i < 256; i++) {
                    const barHeight = (histograms.r[i] / maxCount) * height;
                    ctx.fillRect(i * barWidth, height - barHeight, barWidth, barHeight);
                }
                
                // –ó–µ–ª–µ–Ω—ã–π –∫–∞–Ω–∞–ª
                ctx.fillStyle = 'rgba(0, 255, 0, 0.7)';
                for (let i = 0; i < 256; i++) {
                    const barHeight = (histograms.g[i] / maxCount) * height;
                    ctx.fillRect(i * barWidth, height - barHeight, barWidth, barHeight);
                }
                
                // –°–∏–Ω–∏–π –∫–∞–Ω–∞–ª
                ctx.fillStyle = 'rgba(0, 0, 255, 0.7)';
                for (let i = 0; i < 256; i++) {
                    const barHeight = (histograms.b[i] / maxCount) * height;
                    ctx.fillRect(i * barWidth, height - barHeight, barWidth, barHeight);
                }
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(title, width / 2, 15);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∫–ª–∞–¥–æ–∫
            analysisTab.addEventListener('click', function() {
                setActiveTab('analysis');
                comparisonView.style.display = 'none';
            });
            
            metricsTab.addEventListener('click', function() {
                setActiveTab('metrics');
                comparisonView.style.display = 'none';
            });
            
            comparisonTab.addEventListener('click', function() {
                setActiveTab('comparison');
                comparisonView.style.display = 'flex';
            });
            
            function setActiveTab(tabName) {
                // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                analysisTab.classList.remove('active');
                metricsTab.classList.remove('active');
                comparisonTab.classList.remove('active');
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                if (tabName === 'analysis') {
                    analysisTab.classList.add('active');
                } else if (tabName === 'metrics') {
                    metricsTab.classList.add('active');
                } else if (tabName === 'comparison') {
                    comparisonTab.classList.add('active');
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            loadDefaultImage();
        });
    </script>
</body>
</html>