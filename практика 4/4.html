<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Виртуальный оркестр — Детский Launchpad</title>
  <meta name="description" content="Упрощённый детский Launchpad: включай инструменты, рисуй ритм и мелодию." />
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --card:#0ea5a6; --muted:#94a3b8; --accent:#f97316; --soft:#e6fffa;
      --btn-radius:14px;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071025 0%, #0f1724 100%);color:var(--soft)}
    .app{max-width:1100px;margin:24px auto;padding:18px;background:linear-gradient(180deg,#071a2a,#081022);border-radius:18px;box-shadow:0 10px 40px rgba(2,6,23,.6)}
    header{display:flex;align-items:center;gap:14px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:380px 1fr;gap:16px;margin-top:18px}

    /* left panel controls */
    .panel{background:linear-gradient(180deg,#071826,#071022);padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,0.03)}
    .instruments{display:flex;flex-direction:column;gap:10px}
    .instrument{display:flex;align-items:center;gap:10px;padding:8px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
    .instrument .icon{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.03)}
    .instrument .meta{flex:1}
    .instrument h3{margin:0;font-size:15px}
    .small{font-size:13px;color:var(--muted)}
    .control-row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .toggle{background:transparent;border:2px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:var(--soft);cursor:pointer}
    .toggle.on{background:var(--accent);color:#fff;border-color:transparent}
    .slider{appearance:none;height:8px;border-radius:999px;background:rgba(255,255,255,0.06);width:120px}
    .big-btn{background:var(--card);color:#023;padding:10px 14px;border-radius:12px;border:0;font-weight:700;cursor:pointer}

    /* right: launchpad */
    .launchpad{display:flex;flex-direction:column;gap:12px}
    .controls-row{display:flex;align-items:center;gap:12px}
    .play{background:linear-gradient(90deg,#34d399,#10b981);padding:10px 14px;border-radius:12px;border:0;font-weight:800;cursor:pointer}
    .stop{background:linear-gradient(90deg,#f97316,#fb923c);padding:10px 14px;border-radius:12px;border:0;font-weight:800;cursor:pointer}
    .tempo{display:flex;align-items:center;gap:8px}

    .pad-grid{display:grid;grid-template-rows:repeat(var(--rows),64px);gap:8px}
    .pad-row{display:flex;gap:8px}
    .pad{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,#0c1b25,#08202a);display:flex;align-items:center;justify-content:center;color:var(--soft);font-weight:700;border:2px solid rgba(255,255,255,0.03);cursor:pointer;position:relative}
    .pad.on{background:linear-gradient(180deg,#fde68a,#f97316);color:#102;box-shadow:0 8px 20px rgba(249,115,22,0.18)}
    .pad.playing{outline:3px solid rgba(59,130,246,0.18)}
    .row-label{width:74px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}

    /* mobile adjustments */
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;}
      .panel{order:2}
    }

    footer{margin-top:12px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Детский виртуальный оркестр">
    <header>
      <div>
        <h1>Виртуальный оркестр — Детский Launchpad</h1>
        <div class="subtitle">Включай инструменты, создавай ритм и мелодию — просто нажимай большие плитки!</div>
      </div>
      <div style="margin-left:auto" class="small">Шаблон: 4 инструмента × 8 шагов</div>
    </header>

    <div class="grid">
      <div class="panel">
        <h2 style="margin-top:0">Инструменты</h2>
        <div class="instruments" id="instruments"></div>
        <div style="margin-top:12px" class="small">Регулируй громкость, включай/выключай инструмент. Нажми на плитки справа, чтобы рисовать ритм.</div>
      </div>

      <div>
        <div class="launchpad panel" style="padding:12px">
          <div class="controls-row">
            <button id="playBtn" class="play">▶ Старт</button>
            <button id="stopBtn" class="stop">■ Стоп</button>
            <div class="tempo"><label class="small">Темп</label><input id="tempo" type="range" min="60" max="160" value="100" class="slider"></div>
            <div style="margin-left:auto;display:flex;gap:8px;align-items:center"><button id="clearBtn" class="big-btn">Очистить</button><button id="randomBtn" class="big-btn">Рандом</button></div>
          </div>

          <div style="margin-top:8px;display:flex;align-items:center;gap:12px">
            <div style="display:flex;flex-direction:column;gap:8px;width:74px"></div>
            <div style="flex:1;display:flex;gap:8px;align-items:center">
              <div class="small">Шаги: 8</div>
              <div style="flex:1;background:transparent;height:8px;border-radius:8px"></div>
            </div>
          </div>

          <div id="padArea" style="margin-top:12px">
            <!-- grid rows injected here -->
          </div>

        </div>
        <footer>Клавиши: пробел — старт/пауза, C — очистить, R — рандом</footer>
      </div>
    </div>
  </div>

  <script>
    /*
      Детский Launchpad — HTML/CSS/JS
      - 4 инструмента: ударные, бас, клавишные, духовой (можно поменять)
      - 8 шагов
      - Простая синтез-эммуляция WebAudio + короткие сэмплы (встроенные в виде base64-плейсхолдеров)
      - Легко расширять: добавить больше инструментов, сэмплы или мелодические ноты
    */

    // --- Настройки инструменотов ---
    const INSTRUMENTS = [
      { id:'drum', name:'Ударные', icon: drumSVG(), volume:0.9, type:'perc' },
      { id:'bass', name:'Бас', icon: bassSVG(), volume:0.85, type:'tone', note:45 },
      { id:'keys', name:'Клавиши', icon: keysSVG(), volume:0.8, type:'chord', note:60 },
      { id:'brass', name:'Духовой', icon: brassSVG(), volume:0.75, type:'tone', note:67 }
    ];
    const STEPS = 8;

    // state: grid[instrumentIndex][step]
    const grid = Array.from({length:INSTRUMENTS.length}, ()=>Array.from({length:STEPS}, ()=>false));
    let audioCtx = null; let isPlaying = false; let intervalId = null; let currentStep = 0;
    let tempo = 100; // bpm

    const instrumentsEl = document.getElementById('instruments');
    const padArea = document.getElementById('padArea');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const tempoEl = document.getElementById('tempo');
    const clearBtn = document.getElementById('clearBtn');
    const randomBtn = document.getElementById('randomBtn');

    // --- init UI ---
    function init(){
      // create instrument controls
      INSTRUMENTS.forEach((ins, i)=>{
        const row = document.createElement('div'); row.className='instrument';
        row.innerHTML = `<div class="icon" aria-hidden>${ins.icon}</div><div class="meta"><h3>${ins.name}</h3><div class="small">Громкость <input type="range" min="0" max="1" step="0.01" value="${ins.volume}" data-i="${i}" class="slider"></div></div><div style="display:flex;flex-direction:column;gap:6px"><button class="toggle on" data-i="${i}">Вкл</button></div>`;
        instrumentsEl.appendChild(row);
      });

      // create pad grid
      padArea.innerHTML = '';
      const gridWrap = document.createElement('div'); gridWrap.className='pad-grid'; gridWrap.style.setProperty('--rows', INSTRUMENTS.length);
      INSTRUMENTS.forEach((ins, r)=>{
        const row = document.createElement('div'); row.className='pad-row';
        const label = document.createElement('div'); label.className='row-label'; label.innerHTML = `<div style="text-align:center">${ins.name}</div>`;
        row.appendChild(label);
        for(let s=0;s<STEPS;s++){
          const p = document.createElement('button'); p.className='pad'; p.setAttribute('data-r', r); p.setAttribute('data-s', s); p.innerHTML = s+1;
          p.addEventListener('click', ()=>togglePad(r,s,p));
          row.appendChild(p);
        }
        gridWrap.appendChild(row);
      });
      padArea.appendChild(gridWrap);

      // event listeners
      document.querySelectorAll('.toggle').forEach(btn=>btn.addEventListener('click', (e)=>{
        const i = Number(btn.dataset.i);
        const on = !btn.classList.contains('on');
        btn.classList.toggle('on', on);
        btn.textContent = on ? 'Вкл' : 'Выкл';
        // visually mark row pads dimmed
        Array.from(document.querySelectorAll(`.pad[data-r="${i}"]`)).forEach(p=>p.style.opacity = on? '1':'0.35');
      }));
      document.querySelectorAll('.slider').forEach(sl=>sl.addEventListener('input', (e)=>{
        const i = Number(sl.dataset.i); INSTRUMENTS[i].volume = Number(sl.value);
      }));

      playBtn.addEventListener('click', start);
      stopBtn.addEventListener('click', stop);
      tempoEl.addEventListener('input', (e)=>{ tempo = Number(e.target.value); if(isPlaying) restartInterval(); });
      clearBtn.addEventListener('click', clearGrid);
      randomBtn.addEventListener('click', randomizeGrid);

      // keyboard
      document.addEventListener('keydown', (e)=>{
        if(e.code==='Space'){ e.preventDefault(); isPlaying? stop(): start(); }
        if(e.key.toLowerCase()==='c'){ clearGrid(); }
        if(e.key.toLowerCase()==='r'){ randomizeGrid(); }
      });
    }

    function togglePad(r,s,el){ grid[r][s] = !grid[r][s]; el.classList.toggle('on', grid[r][s]); }

    // clear / random
    function clearGrid(){ for(let r=0;r<grid.length;r++) for(let s=0;s<grid[r].length;s++){ grid[r][s]=false; const el = document.querySelector(`.pad[data-r="${r}"][data-s="${s}"]`); if(el) el.classList.remove('on'); } }
    function randomizeGrid(){ for(let r=0;r<grid.length;r++) for(let s=0;s<grid[r].length;s++){ grid[r][s]=Math.random()>0.65; const el = document.querySelector(`.pad[data-r="${r}"][data-s="${s}"]`); if(el) el.classList.toggle('on', grid[r][s]); } }

    // --- audio generation ---
    function ensureAudioCtx(){ if(!audioCtx){ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } }

    function playSamplePerc(){ // quick percussive kick/snare hybrid
      ensureAudioCtx(); const now = audioCtx.currentTime;
      // low body
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(80, now);
      g.gain.setValueAtTime(0, now); g.gain.exponentialRampToValueAtTime(0.8, now+0.005); g.gain.exponentialRampToValueAtTime(0.0001, now+0.35);
      o.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now+0.36);
      // click
      const b = audioCtx.createBufferSource(); const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate*0.02, audioCtx.sampleRate); const d = buffer.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1)*Math.exp(-30*i/d.length);
      b.buffer=buffer; b.connect(audioCtx.destination); b.start(now+0.01);
    }

    function playBass(note, vol=1){ ensureAudioCtx(); const now = audioCtx.currentTime; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sawtooth'; o.frequency.value = midiToFreq(note); const env = 0.2; g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.7*vol, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+env);
      const filter = audioCtx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=800; o.connect(filter); filter.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now+0.6);
    }

    function playKeys(note, vol=1){ ensureAudioCtx(); const now = audioCtx.currentTime; // simple bell-ish chord
      const freqs = [midiToFreq(note), midiToFreq(note+4), midiToFreq(note+7)]; freqs.forEach((f,idx)=>{ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type = idx===0? 'triangle':'sine'; o.frequency.value=f; g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.25*vol, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.6); o.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now+0.8); });
    }

    function playBrass(note, vol=1){ ensureAudioCtx(); const now=audioCtx.currentTime; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sawtooth'; o.frequency.value = midiToFreq(note); const band = audioCtx.createBiquadFilter(); band.type='bandpass'; band.frequency.value = midiToFreq(note)*1.2; band.Q.value=1.5; g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.45*vol, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.6); o.connect(band); band.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now+0.7);
    }

    function midiToFreq(m){ return 440 * Math.pow(2,(m-69)/12); }

    // play step
    function playStep(s){ for(let r=0;r<INSTRUMENTS.length;r++){
        const ins = INSTRUMENTS[r];
        const enabled = document.querySelectorAll('.toggle')[r].classList.contains('on');
        if(!enabled) continue;
        if(grid[r][s]){
          const vol = INSTRUMENTS[r].volume;
          if(ins.id==='drum') playSamplePerc()*vol;
          else if(ins.id==='bass') playBass(ins.note, vol);
          else if(ins.id==='keys') playKeys(ins.note, vol);
          else if(ins.id==='brass') playBrass(ins.note, vol);
        }
      }
      highlightStep(s);
    }

    function highlightStep(s){ // visual
      document.querySelectorAll('.pad').forEach(p=>p.classList.remove('playing'));
      document.querySelectorAll(`.pad[data-s="${s}"]`).forEach(p=>p.classList.add('playing'));
    }

    function start(){ if(isPlaying) return; ensureAudioCtx(); isPlaying=true; playBtn.textContent='⏸ Пауза'; restartInterval(); }
    function stop(){ if(!isPlaying) return; isPlaying=false; playBtn.textContent='▶ Старт'; clearInterval(intervalId); intervalId=null; currentStep=0; highlightStep(-1); }
    function restartInterval(){ if(intervalId) clearInterval(intervalId); const beatMs = (60000/tempo)/2; // 8 steps per bar -> (60k/bpm)/2
      intervalId = setInterval(()=>{ playStep(currentStep); currentStep = (currentStep+1)%STEPS; }, beatMs); }

    // small safety: wrap percussive function to return promise-like value
    function playSamplePerc(){ ensureAudioCtx(); const now = audioCtx.currentTime; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(100, now); g.gain.setValueAtTime(0, now); g.gain.exponentialRampToValueAtTime(0.9, now+0.004); g.gain.exponentialRampToValueAtTime(0.0001, now+0.28); o.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now+0.3);
      // noise click
      const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate*0.02, audioCtx.sampleRate); const data = buffer.getChannelData(0); for(let i=0;i<data.length;i++) data[i] = (Math.random()*2-1)*Math.exp(-40*i/data.length);
      const src = audioCtx.createBufferSource(); src.buffer = buffer; const g2 = audioCtx.createGain(); g2.gain.value = 0.6; src.connect(g2); g2.connect(audioCtx.destination); src.start(now+0.015); return true; }

    // --- SVG Icons ---
    function drumSVG(){ return `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="6" width="18" height="10" rx="2" fill="currentColor"/></svg>` }
    function bassSVG(){ return `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 3v18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="12" r="3" fill="currentColor"/></svg>` }
    function keysSVG(){ return `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="7" width="20" height="10" rx="1" fill="currentColor"/></svg>` }
    function brassSVG(){ return `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="18" cy="12" r="2" fill="currentColor"/></svg>` }

    // init app
    init();
  </script>
</body>
</html>